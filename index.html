import streamlit as st
import pandas as pd

# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
st.set_page_config(page_title="–£–ó Timetable Generator", layout="wide")

# –§—É–Ω–∫—Ü—ñ—è —Ç—Ä–∞–Ω—Å–ª—ñ—Ç–µ—Ä–∞—Ü—ñ—ó
def transliterate(text):
    ukr_to_eng = {
        '–ê': 'A', '–ë': 'B', '–í': 'V', '–ì': 'H', '“ê': 'G', '–î': 'D', '–ï': 'E', '–Ñ': 'Ye', '–ñ': 'Zh', 
        '–ó': 'Z', '–ò': 'Y', '–Ü': 'I', '–á': 'Yi', '–ô': 'Y', '–ö': 'K', '–õ': 'L', '–ú': 'M', '–ù': 'N', 
        '–û': 'O', '–ü': 'P', '–†': 'R', '–°': 'S', '–¢': 'T', '–£': 'U', '–§': 'F', '–•': 'Kh', '–¶': 'Ts', 
        '–ß': 'Ch', '–®': 'Sh', '–©': 'Shch', '–¨': '', '–Æ': 'Yu', '–Ø': 'Ya',
        '–∞': 'a', '–±': 'b', '–≤': 'v', '–≥': 'h', '“ë': 'g', '–¥': 'd', '–µ': 'e', '—î': 'ye', '–∂': 'zh', 
        '–∑': 'z', '–∏': 'y', '—ñ': 'i', '—ó': 'yi', '–π': 'y', '–∫': 'k', '–ª': 'l', '–º': 'm', '–Ω': 'n', 
        '–æ': 'o', '–ø': 'p', '—Ä': 'r', '—Å': 's', '—Ç': 't', '—É': 'u', '—Ñ': 'f', '—Ö': 'kh', '—Ü': 'ts', 
        '—á': 'ch', '—à': 'sh', '—â': 'shch', '—å': '', '—é': 'yu', '—è': 'ya', '-': '-', ' ': ' '
    }
    return "".join(ukr_to_eng.get(c, c) for c in text)

st.title("üìã –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–æ–∑–∫–ª–∞–¥—É —Ä—É—Ö—É")

# –°—Ç–≤–æ—Ä—é—î–º–æ –ø–æ—Ä–æ–∂–Ω—é —Ç–∞–±–ª–∏—Ü—é –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è (8 –∫–æ–ª–æ–Ω–æ–∫ —è–∫ –Ω–∞ —Ñ–æ—Ç–æ)
if 'data' not in st.session_state:
    st.session_state.data = pd.DataFrame(
        [["", "", "", "", "", "", "", ""]],
        columns=["–ü—Ä–∏–±. (1)", "–°—Ç–æ—è–Ω–∫–∞ (1)", "–í—ñ–¥–ø—Ä. (1)", "–°—Ç–∞–Ω—Ü—ñ—è", "Station", "–ü—Ä–∏–±. (2)", "–°—Ç–æ—è–Ω–∫–∞ (2)", "–í—ñ–¥–ø—Ä. (2)"]
    )

# –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ
edited_df = st.data_editor(st.session_state.data, num_rows="dynamic", use_container_width=True)

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –∫–æ–ª–æ–Ω–∫–∏ Station
if st.button("–û–Ω–æ–≤–∏—Ç–∏ –ø–µ—Ä–µ–∫–ª–∞–¥ (Station)"):
    edited_df['Station'] = edited_df['–°—Ç–∞–Ω—Ü—ñ—è'].apply(transliterate)
    st.session_state.data = edited_df
    st.rerun()

# HTML —à–∞–±–ª–æ–Ω –¥–ª—è –¥—Ä—É–∫—É (—Å—Ç–∏–ª—å —è–∫ –Ω–∞ —Ñ–æ—Ç–æ)
st.markdown("### –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ (–ê4)")
html_table = f"""
<style>
    .uz-table {{ width: 100%; border-collapse: collapse; font-family: Arial; }}
    .uz-table thead th {{ 
        background-color: #2e2e7a; color: white; border: 1px solid white; 
        padding: 8px; text-align: center; font-size: 14px; 
    }}
    .uz-table thead th span {{ display: block; font-size: 10px; font-weight: normal; }}
    .uz-table td {{ border: 1px solid black; padding: 6px; text-align: center; font-size: 13px; }}
    .st-name {{ text-align: left; font-weight: bold; }}
</style>
<table class="uz-table">
    <thead>
        <tr>
            <th>–ü—Ä–∏–±.<span>Arrival</span></th>
            <th>–°—Ç–æ—è–Ω–∫–∞<span>Stop, min</span></th>
            <th>–í—ñ–¥–ø—Ä.<span>Departure</span></th>
            <th>–°—Ç–∞–Ω—Ü—ñ—è</th>
            <th>Station</th>
            <th>–ü—Ä–∏–±.<span>Arrival</span></th>
            <th>–°—Ç–æ—è–Ω–∫–∞<span>Stop, min</span></th>
            <th>–í—ñ–¥–ø—Ä.<span>Departure</span></th>
        </tr>
    </thead>
    <tbody>
        {"".join([f"<tr><td>{row[0]}</td><td>{row[1]}</td><td>{row[2]}</td><td class='st-name'>{row[3]}</td><td>{row[4]}</td><td>{row[5]}</td><td>{row[6]}</td><td>{row[7]}</td></tr>" for row in edited_df.values])}
    </tbody>
</table>
"""

st.markdown(html_table, unsafe_allow_content_allowed=True)

if st.button("–ü—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ –¥–æ –¥—Ä—É–∫—É"):
    st.write("–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å `Ctrl + P`, —â–æ–± –∑–±–µ—Ä–µ–≥—Ç–∏ —è–∫ PDF.")
